{"url": "https://api.github.com/repos/microsoft/AirSim/issues/4524", "repository_url": "https://api.github.com/repos/microsoft/AirSim", "labels_url": "https://api.github.com/repos/microsoft/AirSim/issues/4524/labels{/name}", "comments_url": "https://api.github.com/repos/microsoft/AirSim/issues/4524/comments", "events_url": "https://api.github.com/repos/microsoft/AirSim/issues/4524/events", "html_url": "https://github.com/microsoft/AirSim/issues/4524", "id": 1236867920, "node_id": "I_kwDOBOGC985JuRtQ", "number": 4524, "title": "PX4 HITL + External Offboard Controller + AirSim", "user": {"login": "xubeyb", "id": 42241276, "node_id": "MDQ6VXNlcjQyMjQxMjc2", "avatar_url": "https://avatars.githubusercontent.com/u/42241276?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xubeyb", "html_url": "https://github.com/xubeyb", "followers_url": "https://api.github.com/users/xubeyb/followers", "following_url": "https://api.github.com/users/xubeyb/following{/other_user}", "gists_url": "https://api.github.com/users/xubeyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/xubeyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xubeyb/subscriptions", "organizations_url": "https://api.github.com/users/xubeyb/orgs", "repos_url": "https://api.github.com/users/xubeyb/repos", "events_url": "https://api.github.com/users/xubeyb/events{/privacy}", "received_events_url": "https://api.github.com/users/xubeyb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 538907724, "node_id": "MDU6TGFiZWw1Mzg5MDc3MjQ=", "url": "https://api.github.com/repos/microsoft/AirSim/labels/bug", "name": "bug", "color": "957DAD", "default": true, "description": ""}, {"id": 898812115, "node_id": "MDU6TGFiZWw4OTg4MTIxMTU=", "url": "https://api.github.com/repos/microsoft/AirSim/labels/px4", "name": "px4", "color": "A9DEF9", "default": false, "description": ""}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 16, "created_at": "2022-05-16T09:22:09Z", "updated_at": "2022-06-08T10:41:51Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "Hi everyone and especially Mr. Chris Lovett (@lovettchris),\r\n\r\nWhat is the best way to include my external offboard controller in my simulation environment? \r\n\r\nI am trying to setup a HITL simulation environment for my drone using AirSim. I use a companion computer connected to autopilot through a serial port (a mavlink channel) that takes care of offboard control and some other stuff. I have been using AirSim since a long time and am quite familiar with the sources. I know that AirSim is ready for PX4 HITL and that its configuration is straight forward through settings.json (UseSerial and etc.). Here are my questions:\r\n\r\n**Question 1:** \r\nWhat I have tried to do first was just set AirSim as HITL in settings.json as described in the docs to connect my autopilot to the simulator through USB (ttyACMx) and connect my offboard controller to my autopilot through a serial port as it is in the real system. This caused some instabilities in flights, actually sometimes it led to a meaningless freefall after some flight time (3-5 minutes). I actually couldn't find a reason for this either in airSim or px4 logs. But I think airSim is somehow and somewhat interfering with offboard controller mavlink messages. Can we discuss this? What do you think is wrong with my setup?\r\n\r\n**Question 2:** \r\nAfter failing my first solution, I thought of connecting the autopilot to my offboard controller through airSim and implemented an offboard node in MavLinkMultirotorApi.hpp and have tried to \"route\" offboard controller messages to my pixhawk and pixhawk messages to offboard controller. But I think I am misunderstanding the code. Do you think I am on the right path?\r\n\r\n\r\nThanks\r\n\r\nUbuntu 20.04 LTS\r\nAirSim v1.7.0 (Built from minorly customized source)\r\nUE4.25\r\n\r\n`{\r\n\r\n    \"SettingsVersion\": 1.2,\r\n    \"SimMode\": \"Multirotor\",\r\n    \"Wind\": {\r\n        \"X\": 0,\r\n        \"Y\": 0,\r\n        \"Z\": 0\r\n    },\r\n    \"PawnPaths\": {\r\n        \"DefaultQuadrotor\": {\r\n            \"PawnBP\": \"Class'/Game/Blueprints/BP_FlyingPawn.BP_FlyingPawn_C'\"\r\n        }\r\n    },\r\n    \"DefaultSensors\": {\r\n        \"Barometer\": {\r\n            \"SensorType\": 1,\r\n            \"Enabled\": true\r\n        },\r\n        \"Imu\": {\r\n            \"SensorType\": 2,\r\n            \"Enabled\": true\r\n        },\r\n        \"Gps\": {\r\n            \"SensorType\": 3,\r\n            \"Enabled\": true\r\n        },\r\n        \"Magnetometer\": {\r\n            \"SensorType\": 4,\r\n            \"Enabled\": true\r\n        },\r\n        \"Lidar\": {\r\n            \"SensorType\": 6,\r\n            \"Enabled\": false,\r\n            \"NumberOfChannels\": 4,\r\n            \"PointsPerSecond\": 10000\r\n        }\r\n    },\r\n    \"OriginGeopoint\": {\r\n        \"Latitude\": 39.9334,\r\n        \"Longitude\": 32.8597,\r\n        \"Altitude\": 889\r\n    },\r\n    \"Vehicles\": {\r\n        \"PX4\": {\r\n            \"VehicleType\": \"PX4Multirotor\",\r\n            \"Model\": \"MyCustomMultirotor\",\r\n            \"SerialBaudRate\": 921600,\r\n            \"SerialPort\": \"*\",\r\n            \"UseSerial\": true,\r\n            \"UseTcp\": false,\r\n            \"ControlIP\": \"127.0.0.1\",\r\n            \"ControlPortLocal\": 14580,\r\n            \"ControlPortRemote\": 14540,\r\n            \"UdpIp\": \"\",\r\n            \"UdpPort\": 14540,\r\n            \"TcpPort\": 4560,\r\n            \"VehicleCompID\": 1,\r\n            \"VehicleSysID\": 142,\r\n            \"LocalHostIp\": \"127.0.0.1\",\r\n            \"params\": {\r\n                \"NAV_RCL_ACT\": 0,\r\n                \"NAV_DLL_ACT\": 0,\r\n                \"LPE_LAT\": 47.641468,\r\n                \"LPE_LON\": -122.140165,\r\n                \"COM_OBL_ACT\": 1\r\n            }\r\n        }\r\n    }\r\n}`", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/microsoft/AirSim/issues/4524/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/microsoft/AirSim/issues/4524/timeline", "performed_via_github_app": null, "state_reason": null}